<!DOCTYPE html>

<html lang="en">

<!-- <div class="img-box">
  <iframe src="https://momento360.com/e/u/da66a83b51fc47b8a3c145c1557b8740?utm_campaign=embed&utm_source=other&heading=0&pitch=0&field-of-view=75&size=medium">
  </iframe>
</div> -->

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link rel="stylesheet" href="./dist/main.css" />
  <title>EtymoloGenius</title>
</head>

<body>
  <div class="head-banner"> </div>
  <div id="etymologenius">EtymoloGenius</div>

  <form class="search-form">
    <input type="text" id="searchBar" placeholder="Lookup a word...">
    <button id="submit" type="button" onclick="searchOutput()">Go!</button>
  </form>
  <div id="part-of-speech"></div>
  <div id="output"></div>
  <div id="placeholder-text">Welcome to EtymoloGenius! Simply submit a word, and watch its journey to English.</div>
  <div id="pronunciation"></div>
  <div id="definition"></div>
  <div id="country-list"></div>
  <div id="other-info"></div>

   
    
      
  <div id="etymologies"></div>
  <div id="countries">countries</div>
  <!-- <div id="time">time</div> -->
 
    

    <script src="./src/scripts/countries.js"></script>
    
  



    <script src="//cdn.amcharts.com/lib/4/core.js"></script>
    <script src="//cdn.amcharts.com/lib/4/maps.js"></script>
    <script src="//cdn.amcharts.com/lib/4/geodata/worldLow.js"></script>
    <div id="globediv" style="width: 475px; height: 475px;"></div>

    <script src="./src/scripts/maps.js"></script>

    <script>

      function resetSearch() {
        let searched = document.getElementById('searchBar');
        searched.value = '';
      }

      const lineSeries = chart.series.push(new am4maps.MapLineSeries());


      function searchOutput() {
          var userInput = document.getElementById('searchBar').value;
          document.getElementById("placeholder-text").style.display = "none";
          document.getElementById('output').innerHTML = userInput;

          // fetching from dictionary API
          const app_id = "aefa1dac"; // insert your APP Id
          const app_key = "11e3bb87b4b4fa64832a3ce1570ff663"; // insert your APP Key
          const wordId = userInput;
          // const fields = "etymologies";
          const strictMatch = "false";

          const endpoint = "entries";
          const languageCode = "en-us";

          const countries = ["United Kingdom"];


          const bigURL = "https://cors-anywhere.herokuapp.com/https://od-api.oxforddictionaries.com/api/v2/" + endpoint + "/" + languageCode + "/" + wordId.toLowerCase()

          function findCoordinates() {
            let countryArray = document.getElementById('countries').innerHTML.split(",");
            let coords = [];
            countryArray.forEach(country => {
              coords.push(latAndLongs[country]);
            });
            if (coords.length === 0) {
              return null
            } else {
              drawLines(coords);
              panToOriginCountry(coords.reverse()[0]);
            }      
          }


          function drawLines(coordsArray) {
            lineSeries.data = [{
              "multiGeoLine": [
                coordsArray
              ]
            }];
          }

          function panToOriginCountry(coordsPair) {
            chart.animate([{
              property: "deltaLongitude",
              to: -coordsPair["longitude"]
            }, {
              property: "deltaLatitude",
              to: -coordsPair["latitude"]
            }], 1000)
          }

          function capitalize(string) {
            answer = "";
            let chars = string.split("");
            chars.forEach((char,i) => {
              i === 0 ? answer += char.toUpperCase() : answer += char
            })
            return answer;
          }

      

          fetch(bigURL, { headers: { "app_id": app_id, "app_key": app_key } })
            .then(response => response.json())
            .then(data => {
              const etymologyText = data.results[0].lexicalEntries[0].entries[0].etymologies[0];
              const partOfSpeech = data.results[0].lexicalEntries[0].lexicalCategory["id"];
              const definition = data.results[0].lexicalEntries[0].entries[0].senses[0].definitions[0];
              const pronunciation = data.results[0].lexicalEntries[0].entries[0].pronunciations[0].phoneticSpelling;
              document.getElementById('etymologies').innerHTML = etymologyText;
              document.getElementById('part-of-speech').innerHTML = partOfSpeech;
              document.getElementById('pronunciation').innerHTML = pronunciation;
              document.getElementById('definition').innerHTML = etymologyText + ";" + " " + definition;
              document.getElementById('country-list').innerHTML = capitalize(userInput) + extractCountries(etymologyText);
              extractTime(etymologyText);
              findCoordinates();
              resetSearch();
            })
            .catch(error => window.alert("Oops, we don't have access to that word at the moment, or you might have to reset the API key."));
          // .then(data => console.log(data.results[0].lexicalEntries[0].entries[0].etymologies[0]));




          // finish fetching from dictionary API
        }


    </script>
</body>

</html>